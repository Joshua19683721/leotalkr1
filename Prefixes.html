<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>AI è¬ç”¨å–®å­—éª¨æ¶ 9.8 - è‡ªå‹•ç¿»è­¯ç‰ˆ</title>
    <style>
        :root { --prefix-clr: #ef4444; --root-clr: #2563eb; --suffix-clr: #10b981; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', 'PingFang TC', sans-serif; background: var(--bg); padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 900px; width: 100%; }
        .lab-station { background: #fff; padding: 25px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; margin-bottom: 20px; position: sticky; top: 10px; z-index: 1000; }
        .display-area { display: flex; justify-content: center; gap: 8px; margin-bottom: 15px; }
        .part-box { padding: 10px 15px; border-radius: 10px; background: #e2e8f0; font-weight: 800; font-size: 1.3rem; }
        .result-panel { background: #1e293b; color: #f8fafc; padding: 30px; border-radius: 20px; text-align: left; display: none; border-left: 8px solid #fbbf24; }
        .word-header { display: flex; align-items: center; gap: 15px; margin-bottom: 10px; }
        .translation-main { font-size: 2.2rem; color: #fbbf24; font-weight: 900; }
        .definition-block { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; margin-top: 15px; }
        .lang-label { font-size: 0.7rem; background: #475569; padding: 2px 6px; border-radius: 4px; margin-bottom: 5px; display: inline-block; }
        .audio-btn { background: #4f46e5; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: 0.3s; }
        .audio-btn:hover { background: #4338ca; }
        .control-panel { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .column { background: #fff; padding: 15px; border-radius: 18px; height: 45vh; overflow-y: auto; border: 1px solid #e2e8f0; }
        button { width: 100%; padding: 12px; margin: 4px 0; border: 1px solid #f1f5f9; border-radius: 8px; cursor: pointer; background: #f8fafc; text-align: left; }
        button.active { background: #1e293b !important; color: white !important; }
        .loading-dots:after { content: ' .'; animation: dots 1s steps(5, end) infinite; }
        @keyframes dots { 0%, 20% { content: ' .'; } 40% { content: ' ..'; } 60% { content: ' ...'; } 80%, 100% { content: ''; } }
    </style>
</head>
<body>

<div class="container">
    <div class="lab-station">
        <div id="status" style="font-size:0.85rem; color:#64748b; margin-bottom:10px;">è«‹çµ„åˆé›¶ä»¶ä»¥èª¿ç”¨å…¨çƒå­—å…¸æ•¸æ“šåº«</div>
        <div class="display-area">
            <div class="part-box" id="boxPre">-</div>
            <div class="part-box" id="boxRoot">å­—æ ¹</div>
            <div class="part-box" id="boxSuf">-</div>
        </div>
        <h2 id="resultWord" style="margin: 0; font-size: 3rem; text-transform: lowercase; color: #1e293b;">---</h2>
        
        <div class="result-panel" id="resultPanel">
            <div class="word-header">
                <span id="wordUpper" style="font-size: 1.2rem; color: #94a3b8; letter-spacing: 2px;">WORD</span>
                <button id="audioBtn" class="audio-btn" style="display:none;">ğŸ”Š Listen</button>
            </div>
            
            <div id="chineseSection">
                <span class="lang-label">ZH-TW ç¹é«”ä¸­æ–‡è§£æ</span>
                <div id="wordTrans" class="translation-main">æ­£åœ¨ç¿»è­¯ä¸­<span class="loading-dots"></span></div>
            </div>

            <div class="definition-block">
                <span class="lang-label">EN è‹±æ–‡æ¬Šå¨å®šç¾©</span>
                <div id="englishDef" style="line-height: 1.6; color: #cbd5e1;">Fetching definition...</div>
            </div>

            <div id="logicText" style="margin-top:20px; font-size:0.9rem; color:#64748b; border-top: 1px solid #334155; padding-top: 15px;"></div>
        </div>
    </div>

    <div class="control-panel">
        <div class="column" id="preCol"><h3>1. å‰ç¶´</h3><button onclick="selectPart('pre', '')">âˆ… NONE</button></div>
        <div class="column" id="rootCol"><h3>2. å­—æ ¹</h3><button onclick="selectPart('root', '')">âˆ… NONE</button></div>
        <div class="column" id="sufCol"><h3>3. å¾Œç¶´</h3><button onclick="selectPart('suf', '')">âˆ… NONE</button></div>
    </div>
</div>

<script>
    const config = {
        pre: { "In": "å‘å…§/ä¸", "Ex": "å‘å¤–", "Re": "å›/å†", "Pro": "å‘å‰", "Trans": "æ©«è·¨", "Sub": "åœ¨ä¸‹", "Con": "å…±åŒ" },
        root: { "Act": "å‹•", "Port": "æ¬é‹", "Vis": "çœ‹", "Spect": "å¯Ÿ", "Dict": "èªª", "Mot": "ç§»å‹•", "Scrib": "å¯«", "Press": "å£“" },
        suf: { "ion": "åè©", "ive": "å½¢å®¹è©", "able": "å½¢å®¹è©(èƒ½)", "or": "äºº/ç‰©", "er": "äºº/ç‰©", "ate": "å‹•è©" }
    };

    let state = { pre: '', root: '', suf: '' };
    let audioObj = null;

    function init() {
        ['pre', 'root', 'suf'].forEach(type => {
            const container = document.getElementById(`${type}Col`);
            Object.entries(config[type]).forEach(([k, v]) => {
                const b = document.createElement('button');
                b.id = `btn-${type}-${k}`;
                b.innerHTML = `<strong>${k}</strong> <small>${v}</small>`;
                b.onclick = () => selectPart(type, k);
                container.appendChild(b);
            });
        });
    }

    function selectPart(type, key) {
        state[type] = key;
        document.querySelectorAll(`#${type}Col button`).forEach(b => b.classList.remove('active'));
        if(key) document.getElementById(`btn-${type}-${key}`).classList.add('active');
        document.getElementById(`box${type.charAt(0).toUpperCase() + type.slice(1)}`).innerText = key || '-';
        
        const word = (state.pre + state.root + state.suf).toLowerCase();
        document.getElementById('resultWord').innerText = word || "---";
        if(word.length > 2) performFullSearch(word);
    }

    async function performFullSearch(word) {
        const panel = document.getElementById('resultPanel');
        panel.style.display = 'block';
        document.getElementById('status').innerText = "ğŸŒ æ­£åœ¨ä¸²æ¥ Google Dictionary èˆ‡ç¿»è­¯å¼•æ“...";
        document.getElementById('wordUpper').innerText = word.toUpperCase();
        document.getElementById('wordTrans').innerHTML = 'ç¿»è­¯ä¸­<span class="loading-dots"></span>';
        document.getElementById('englishDef').innerText = "æ­£åœ¨è®€å–è‹±æ–‡å®šç¾©...";
        document.getElementById('audioBtn').style.display = 'none';

        try {
            // 1. æŠ“å–è‹±æ–‡å®šç¾©
            const dictRes = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
            const dictData = await dictRes.json();
            
            if (dictData[0]) {
                const defEn = dictData[0].meanings[0].definitions[0].definition;
                document.getElementById('englishDef').innerText = defEn;

                // 2. èª¿ç”¨ MyMemory API é€²è¡Œç¿»è­¯
                const transRes = await fetch(`https://api.mymemory.translated.net/get?q=${word}&langpair=en|zh-TW`);
                const transData = await transRes.json();
                const translatedText = transData.responseData.translatedText;
                
                document.getElementById('wordTrans').innerText = translatedText;

                // 3. è™•ç†éŸ³æª”
                const audioLink = dictData[0].phonetics.find(p => p.audio)?.audio;
                if (audioLink) {
                    audioObj = new Audio(audioLink);
                    document.getElementById('audioBtn').style.display = 'inline-block';
                    document.getElementById('audioBtn').onclick = () => audioObj.play();
                }
                document.getElementById('status').innerText = "âœ… æ•¸æ“šèª¿ç”¨å®Œç•¢";
            }
        } catch (e) {
            document.getElementById('wordTrans').innerText = "æŸ¥è©¢å¤±æ•—";
            document.getElementById('englishDef').innerText = "å­—å…¸æœªæ”¶éŒ„æ­¤æ‹¼å¯«çµ„åˆï¼Œè«‹ç¢ºèªå­—æ ¹çµ„åˆæ˜¯å¦æ­£ç¢ºã€‚";
            document.getElementById('status').innerText = "âš ï¸ æ‰¾ä¸åˆ°è©²å–®å­—";
        }
        
        document.getElementById('logicText').innerHTML = `æ§‹è©é‚è¼¯ï¼š${config.pre[state.pre]||''} + ${config.root[state.root]||''} + ${config.suf[state.suf]||''}`;
    }

    init();
</script>
</body>
</html>
