<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>AI è¬ç”¨å–®å­—éª¨æ¶ 9.6 - è¯ç¶² API ç‰ˆ</title>
    <style>
        :root { --prefix-clr: #ef4444; --root-clr: #2563eb; --suffix-clr: #10b981; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 1200px; width: 100%; }
        .lab-station { background: #fff; padding: 25px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; margin-bottom: 20px; position: sticky; top: 10px; z-index: 1000; }
        .display-area { display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; }
        .part-box { padding: 10px 20px; border-radius: 12px; background: #e2e8f0; font-weight: 800; font-size: 1.5rem; transition: 0.3s; }
        .part-box.active { color: white; background: #64748b; }
        .result-panel { background: #1e293b; color: #f8fafc; padding: 25px; border-radius: 20px; text-align: left; display: none; margin-top: 15px; border-left: 6px solid #fbbf24; }
        .api-status { font-size: 0.8rem; color: #fbbf24; margin-bottom: 5px; font-weight: bold; }
        .translation-text { font-size: 2.2rem; color: #fbbf24; font-weight: 900; }
        .audio-btn { background: #4f46e5; color: white; border: none; padding: 5px 12px; border-radius: 5px; cursor: pointer; margin-left: 10px; font-size: 0.9rem; }
        .control-panel { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .column { background: #fff; padding: 15px; border-radius: 18px; height: 50vh; overflow-y: auto; border: 1px solid #e2e8f0; }
        button { width: 100%; padding: 12px; margin: 4px 0; border: 1px solid #f1f5f9; border-radius: 10px; cursor: pointer; background: #f8fafc; text-align: left; display: flex; justify-content: space-between; }
        button.active { background: #1e293b !important; color: white !important; }
        .definition-list { margin-top: 10px; font-size: 0.95rem; color: #cbd5e1; }
    </style>
</head>
<body>

<div class="container">
    <div class="lab-station">
        <div class="api-status" id="apiStatus">ç‹€æ…‹ï¼šç­‰å¾…è¼¸å…¥ä¸­</div>
        <div class="display-area">
            <div class="part-box" id="boxPre">-</div>
            <div class="part-box" id="boxRoot">è«‹é¸é›¶ä»¶</div>
            <div class="part-box" id="boxSuf">-</div>
        </div>
        <h2 id="resultWord" style="margin: 0; font-size: 2.8rem; text-transform: lowercase;">---</h2>
        
        <div class="result-panel" id="resultPanel">
            <div style="display: flex; align-items: center;">
                <div id="wordTrans" class="translation-text">æŸ¥è©¢ä¸­...</div>
                <button id="audioBtn" class="audio-btn" style="display:none;">ğŸ”Š ç™¼éŸ³</button>
            </div>
            <div id="wordPos" style="color:#10b981; font-weight:bold; margin: 5px 0;"></div>
            <div id="apiContent" class="definition-list"></div>
            <div id="logicBreakdown" style="border-top:1px solid #334155; margin-top:15px; padding-top:15px; color:#94a3b8; font-size:0.9rem;"></div>
        </div>
    </div>

    <div class="control-panel">
        <div class="column" id="preCol"><h3>1. å‰ç¶´</h3><button onclick="selectPart('pre', '')">âˆ… NONE</button></div>
        <div class="column" id="rootCol"><h3>2. å­—æ ¹</h3><button onclick="selectPart('root', '')">âˆ… NONE</button></div>
        <div class="column" id="sufCol"><h3>3. å¾Œç¶´</h3><button onclick="selectPart('suf', '')">âˆ… NONE</button></div>
    </div>
</div>

<script>
    const config = {
        pre: { "In": "å…§/ä¸", "Ex": "å¤–", "Re": "å›/å†", "Pro": "å‰", "Trans": "æ©«è·¨", "Sub": "ä¸‹", "Con": "å…±", "De": "ä¸‹/å»", "Pre": "é " },
        root: { "Act": "å‹•", "Port": "æ¬", "Vis": "çœ‹", "Spect": "å¯Ÿ", "Dict": "èªª", "Ject": "æŠ•", "Mit": "é€", "Struct": "å»º", "Scrib": "å¯«", "Tract": "æ‹‰", "Press": "å£“", "Mot": "å‹•" },
        suf: { "ion": "åè©", "ive": "å½¢å®¹è©", "able": "å½¢å®¹è©(èƒ½)", "or": "äºº/ç‰©", "ly": "å‰¯è©", "ment": "åè©(çµ)", "ate": "å‹•è©" }
    };

    let state = { pre: '', root: '', suf: '' };
    let currentAudio = null;

    function init() {
        ['pre', 'root', 'suf'].forEach(type => {
            const container = document.getElementById(`${type}Col`);
            Object.entries(config[type]).forEach(([k, v]) => {
                const b = document.createElement('button');
                b.id = `btn-${type}-${k}`;
                b.innerHTML = `<span><strong>${k}</strong></span> <small>${v}</small>`;
                b.onclick = () => selectPart(type, k);
                container.appendChild(b);
            });
        });
    }

    function selectPart(type, key) {
        state[type] = key;
        document.querySelectorAll(`#${type}Col button`).forEach(btn => btn.classList.remove('active'));
        if(key) document.getElementById(`btn-${type}-${key}`).classList.add('active');
        document.getElementById(`box${type.charAt(0).toUpperCase() + type.slice(1)}`).innerText = key || '-';
        
        const word = (state.pre + state.root + state.suf).toLowerCase();
        document.getElementById('resultWord').innerText = word || "---";
        if(word.length > 2) fetchDefinition(word);
    }

    async function fetchDefinition(word) {
        const panel = document.getElementById('resultPanel');
        const apiStatus = document.getElementById('apiStatus');
        const apiContent = document.getElementById('apiContent');
        panel.style.display = 'block';
        apiStatus.innerText = "ğŸŒ æ­£åœ¨èª¿ç”¨ Merriam/Google æ•¸æ“šåº«...";
        apiContent.innerHTML = "æ­£åœ¨å³æ™‚è§£æå–®å­—èªç¾©...";

        try {
            const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
            if (!response.ok) throw new Error();
            const data = await response.json();
            const entry = data[0];

            apiStatus.innerText = "âœ… è¯ç¶²æŸ¥è©¢æˆåŠŸ";
            document.getElementById('wordTrans').innerText = word.toUpperCase();
            document.getElementById('wordPos').innerText = entry.meanings[0].partOfSpeech.toUpperCase();
            
            // æŠ“å–è§£é‡‹
            let defs = entry.meanings[0].definitions.slice(0, 2).map(d => `<li>${d.definition}</li>`).join('');
            apiContent.innerHTML = `<ul style="padding-left:20px;">${defs}</ul>`;

            // è™•ç†ç™¼éŸ³
            const audioUrl = entry.phonetics.find(p => p.audio)?.audio;
            if (audioUrl) {
                currentAudio = new Audio(audioUrl);
                document.getElementById('audioBtn').style.display = 'inline-block';
                document.getElementById('audioBtn').onclick = () => currentAudio.play();
            } else {
                document.getElementById('audioBtn').style.display = 'none';
            }
        } catch (e) {
            apiStatus.innerText = "âš ï¸ å­—å…¸æœªæ”¶éŒ„è©²æ‹¼æ³•ï¼Œåˆ‡æ›è‡³ AI é‚è¼¯æ¨æ¸¬";
            document.getElementById('wordTrans').innerText = "æœªæ”¶éŒ„å–®å­—";
            apiContent.innerHTML = "æç¤ºï¼šé€™å¯èƒ½æ˜¯ä¸€å€‹ç½•è¦‹çµ„åˆï¼Œæˆ–è«‹æª¢æŸ¥æ‹¼å¯«ï¼ˆå¦‚ reporter vs reportorï¼‰ã€‚";
        }

        // æ°¸é é¡¯ç¤ºå­—æ ¹é‚è¼¯è§£æ§‹
        document.getElementById('logicBreakdown').innerHTML = `
            <strong>å­—æ ¹é‚è¼¯ï¼š</strong> ${config.pre[state.pre] || ''} (${state.pre}) + 
            ${config.root[state.root] || ''} (${state.root}) + 
            ${config.suf[state.suf] || ''} (${state.suf})
        `;
    }

    init();
</script>
</body>
</html>
